/* eslint-disable @typescript-eslint/no-unused-vars */
/* eslint-disable no-prototype-builtins */
/* eslint-disable @typescript-eslint/triple-slash-reference */
Object.size = function (obj) {
    let size = 0, key;
    for (key in obj) {
        if (obj.hasOwnProperty(key))
            size++;
    }
    return size;
};
Object.child = function (str, callback) {
    const self = this;
    if (self.hasOwnProperty(str)) {
        if (typeof callback == 'function') {
            return callback(self[str]);
        }
        else {
            return true;
        }
    }
    else {
        return undefined;
    }
};
Object.alt = function (str, alternative) {
    const self = this;
    if (self.hasOwnProperty(str)) {
        return self[str];
    }
    else {
        return alternative;
    }
};
Object.has = function (str) {
    return this.hasOwnProperty(str);
};
Object.each = function (callback) {
    for (const key in this) {
        //callback.call(scope, key, this[key]);
        callback.call(this[key]);
    }
};
Object.isEmpty = function () {
    return this.length === 0;
};
Object.replaceKeyFrom = function (anotherObj) {
    return Object.entries(this).reduce((op, [key, value]) => {
        const newKey = anotherObj[key];
        op[newKey || key] = value;
        return op;
    }, {});
    /*if (typeof anotherObj == 'object') {
      for (const key in anotherObj) {
        if (Object.prototype.hasOwnProperty.call(anotherObj, key)) {
          const element = anotherObj[key];
          def[key] = element;
        }
      }
    }*/
};
class object_ext {
    /**
     * Join object to separated string
     * * [].join() equivalent
     * @param obj Object
     * @param separator default comma(,)
     * @returns Joined string
     */
    static object_join(obj, separator = ',') {
        return Object.keys(obj)
            .map(function (k) {
            return obj[k];
        })
            .join(separator);
    }
    /**
     * Simple object check.
     * @param item
     * @returns
     */
    static isObject(item) {
        return item && typeof item === 'object' && !Array.isArray(item);
    }
    /**
     * Deep merge two objects.
     * @param target
     * @param ...sources
     */
    static mergeDeep(target, ...sources) {
        if (!sources.length)
            return target;
        const source = sources.shift();
        if (object_ext.isObject(target) && object_ext.isObject(source)) {
            for (const key in source) {
                if (object_ext.isObject(source[key])) {
                    if (!target[key])
                        Object.assign(target, { [key]: {} });
                    object_ext.mergeDeep(target[key], source[key]);
                }
                else {
                    Object.assign(target, { [key]: source[key] });
                }
            }
        }
        return object_ext.mergeDeep(target, ...sources);
    }
}
Object.prototype.merge = function (...others) {
    return object_ext.mergeDeep(this, ...others);
};
if (typeof window != 'undefined' && window instanceof Window) {
    window.object_join = object_ext.object_join;
    window.object_merge = object_ext.mergeDeep;
    window.isObject = object_ext.isObject;
}
else if (typeof global == 'object') {
    global.object_join = object_ext.object_join;
    global.object_merge = object_ext.mergeDeep;
    global.isObject = object_ext.isObject;
}
if (typeof module != 'undefined' && typeof module == 'object') {
    module.exports = object_ext;
    module.exports = {
        object_join: object_ext.object_join,
        object_merge: object_ext.mergeDeep,
        isObject: object_ext.isObject,
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT2JqZWN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL09iamVjdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxzREFBc0Q7QUFDdEQsMENBQTBDO0FBQzFDLDhEQUE4RDtBQTRFOUQsTUFBTSxDQUFDLElBQUksR0FBRyxVQUFVLEdBQUc7SUFDekIsSUFBSSxJQUFJLEdBQUcsQ0FBQyxFQUNWLEdBQVEsQ0FBQztJQUNYLEtBQUssR0FBRyxJQUFJLEdBQUcsRUFBRTtRQUNmLElBQUksR0FBRyxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUM7WUFBRSxJQUFJLEVBQUUsQ0FBQztLQUNyQztJQUNELE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQyxDQUFDO0FBRUYsTUFBTSxDQUFDLEtBQUssR0FBRyxVQUFVLEdBQUcsRUFBRSxRQUFRO0lBQ3BDLE1BQU0sSUFBSSxHQUFXLElBQUksQ0FBQztJQUMxQixJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDNUIsSUFBSSxPQUFPLFFBQVEsSUFBSSxVQUFVLEVBQUU7WUFDakMsT0FBTyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDNUI7YUFBTTtZQUNMLE9BQU8sSUFBSSxDQUFDO1NBQ2I7S0FDRjtTQUFNO1FBQ0wsT0FBTyxTQUFTLENBQUM7S0FDbEI7QUFDSCxDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsR0FBRyxHQUFHLFVBQVUsR0FBRyxFQUFFLFdBQVc7SUFDckMsTUFBTSxJQUFJLEdBQVEsSUFBSSxDQUFDO0lBQ3ZCLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsRUFBRTtRQUM1QixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUNsQjtTQUFNO1FBQ0wsT0FBTyxXQUFXLENBQUM7S0FDcEI7QUFDSCxDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsR0FBRyxHQUFHLFVBQVUsR0FBb0I7SUFDekMs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QVUsQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLEdBQUcsTUFBTSxDQUFDLENBQUM7QUFDL0MsQ0FBQyxDQUFDO0FBRUYsSUFBSSxPQUFPLE1BQU0sSUFBSSxXQUFXLElBQUksTUFBTSxZQUFZLE1BQU0sRUFBRTtJQUM1RCxNQUFNLENBQUMsV0FBVyxHQUFHLFVBQVUsQ0FBQyxXQUFXLENBQUM7SUFDNUMsTUFBTSxDQUFDLFlBQVksR0FBRyxVQUFVLENBQUMsU0FBUyxDQUFDO0lBQzNDLE1BQU0sQ0FBQyxRQUFRLEdBQUcsVUFBVSxDQUFDLFFBQVEsQ0FBQztDQUN2QztLQUFNLElBQUksT0FBTyxNQUFNLElBQUksUUFBUSxFQUFFO0lBQ3BDLE1BQU0sQ0FBQyxXQUFXLEdBQUcsVUFBVSxDQUFDLFdBQVcsQ0FBQztJQUM1QyxNQUFNLENBQUMsWUFBWSxHQUFHLFVBQVUsQ0FBQyxTQUFTLENBQUM7SUFDM0MsTUFBTSxDQUFDLFFBQVEsR0FBRyxVQUFVLENBQUMsUUFBUSxDQUFDO0NBQ3ZDO0FBQ0QsSUFBSSxPQUFPLE1BQU0sSUFBSSxXQUFXLElBQUksT0FBTyxNQUFNLElBQUksUUFBUSxFQUFFO0lBQzdELE1BQU0sQ0FBQyxPQUFPLEdBQUcsVUFBVSxDQUFDO0lBQzVCLE1BQU0sQ0FBQyxPQUFPLEdBQUc7UUFDZixXQUFXLEVBQUUsVUFBVSxDQUFDLFdBQVc7UUFDbkMsWUFBWSxFQUFFLFVBQVUsQ0FBQyxTQUFTO1FBQ2xDLFFBQVEsRUFBRSxVQUFVLENBQUMsUUFBUTtLQUM5QixDQUFDO0NBQ0giLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnMgKi9cbi8qIGVzbGludC1kaXNhYmxlIG5vLXByb3RvdHlwZS1idWlsdGlucyAqL1xuLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L3RyaXBsZS1zbGFzaC1yZWZlcmVuY2UgKi9cblxuaW50ZXJmYWNlIE9iamVjdCB7XG4gIGxlbmd0aDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBEeW5hbWljIEtleVxuICAgKi9cbiAgW3N0cjogc3RyaW5nXTogYW55O1xuXG4gIC8qKlxuICAgKiBNZXJnZSB0aGlzIG9iamVjdCB3aXRoIGFub3RoZXIgb2JqZWN0XG4gICAqL1xuICBtZXJnZTogKC4uLm90aGVyOiBSZWNvcmQ8YW55LCB1bmtub3duPltdKSA9PiBSZWNvcmQ8YW55LCB1bmtub3duPjtcblxuICAvKipcbiAgICogSXRlcmF0ZSBPYmplY3RcbiAgICogQHBhcmFtIGNhbGxiYWNrIGZ1bmN0aW9uIGVhY2ggZWxlbWVudFxuICAgKiBAZXhhbXBsZVxuICAgKiB2YXIgYSA9IHsnYScsJ24nfTtcbiAgICogYS5lYWNoKGZ1bmN0aW9uKGVsKXtcbiAgICogIGNvbnNvbGUubG9nKGVsKTsgLy9hLCBuIGVhY2ggaXRlcmF0aW9uXG4gICAqIH0pXG4gICAqL1xuICBlYWNoKGNhbGxiYWNrOiAoYXJnMDogYW55KSA9PiBhbnkpOiBhbnk7XG5cbiAgLyoqXG4gICAqIENoZWNrIGlzIGVtcHR5XG4gICAqL1xuICBpc0VtcHR5KCk6IGJvb2xlYW47XG5cbiAgcmVwbGFjZUtleUZyb20oYW5vdGhlck9iajogYW55KTogYW55O1xufVxuXG5pbnRlcmZhY2UgT2JqZWN0Q29uc3RydWN0b3Ige1xuICAvKipcbiAgICogRHluYW1pYyBLZXlcbiAgICovXG4gIFtzdHI6IHN0cmluZ106IGFueTtcblxuICAvKipcbiAgICogQ291bnQgc2l6ZSBsZW5ndGggb2Ygb2JqZWN0XG4gICAqL1xuICBzaXplOiAob2JqOiBhbnkpID0+IG51bWJlcjtcblxuICAvL1twYWlyOiBzdHJpbmd8bnVtYmVyXTogYW55O1xuXG4gIC8qKlxuICAgKiBJcyBPYmplY3QgSGFzIFByb3BlcnR5IG9mIGtleSA/XG4gICAqIEBwYXJhbSBrZXlcbiAgICovXG4gIGhhc093blByb3BlcnR5KGtleTogYW55KTogYm9vbGVhbjtcblxuICAvKipcbiAgICogY2hlY2sgaWYgaGFzIGNoaWxkIGFuZCBnbyBmb3IgY2FsbGJhY2tcbiAgICogQHBhcmFtIHN0ciAgbWF0Y2ggY2hpbGQgcHJvcGVydHlcbiAgICogQHBhcmFtIGNhbGxiYWNrIGZ1bmN0aW9uIGNhbGxiYWNrXG4gICAqIEBhdXRob3IgRGltYXMgTGFuamFrYSA8ZGltYXNsYW5qYWthQGdtYWlsLmNvbT5cbiAgICovXG4gIGNoaWxkKHN0cjogc3RyaW5nIHwgbnVtYmVyLCBjYWxsYmFjazogKGFyZzogYW55KSA9PiBhbnkpOiBhbnk7XG5cbiAgLyoqXG4gICAqIGNoZWNrIG9iamVjdCBoYXMgY2hpbGQsIGlmIG5vdCBleGlzdCByZXR1cm4gYWx0ZXJuYXRpdmUgdmFsdWVcbiAgICogQHBhcmFtIHN0ciBtYXRjaCBjaGlsZCBwcm9wZXJ0eVxuICAgKiBAcGFyYW0gYWx0ZXJuYXRpdmUgZGVmYXVsdCB2YWx1ZSBjYWxsYmFja1xuICAgKiBAYXV0aG9yIERpbWFzIExhbmpha2EgPGRpbWFzbGFuamFrYUBnbWFpbC5jb20+XG4gICAqL1xuICBhbHQoc3RyOiBhbnksIGFsdGVybmF0aXZlOiBzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuKTogYW55O1xuXG4gIC8qKlxuICAgKiBDaGVjayBvYmplY3QgaGFzIGNoaWxkXG4gICAqIEBwYXJhbSBzdHJcbiAgICovXG4gIGhhcyhzdHI6IHN0cmluZyB8IG51bWJlcik6IGFueTtcbn1cblxuT2JqZWN0LnNpemUgPSBmdW5jdGlvbiAob2JqKSB7XG4gIGxldCBzaXplID0gMCxcbiAgICBrZXk6IGFueTtcbiAgZm9yIChrZXkgaW4gb2JqKSB7XG4gICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSBzaXplKys7XG4gIH1cbiAgcmV0dXJuIHNpemU7XG59O1xuXG5PYmplY3QuY2hpbGQgPSBmdW5jdGlvbiAoc3RyLCBjYWxsYmFjaykge1xuICBjb25zdCBzZWxmOiBvYmplY3QgPSB0aGlzO1xuICBpZiAoc2VsZi5oYXNPd25Qcm9wZXJ0eShzdHIpKSB7XG4gICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soc2VsZltzdHJdKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbn07XG5cbk9iamVjdC5hbHQgPSBmdW5jdGlvbiAoc3RyLCBhbHRlcm5hdGl2ZSkge1xuICBjb25zdCBzZWxmOiBhbnkgPSB0aGlzO1xuICBpZiAoc2VsZi5oYXNPd25Qcm9wZXJ0eShzdHIpKSB7XG4gICAgcmV0dXJuIHNlbGZbc3RyXTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYWx0ZXJuYXRpdmU7XG4gIH1cbn07XG5cbk9iamVjdC5oYXMgPSBmdW5jdGlvbiAoc3RyOiBzdHJpbmcgfCBudW1iZXIpIHtcbiAgcmV0dXJuIHRoaXMuaGFzT3duUHJvcGVydHkoc3RyKTtcbn07XG5cbk9iamVjdC5lYWNoID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gIGZvciAoY29uc3Qga2V5IGluIHRoaXMpIHtcbiAgICAvL2NhbGxiYWNrLmNhbGwoc2NvcGUsIGtleSwgdGhpc1trZXldKTtcbiAgICBjYWxsYmFjay5jYWxsKHRoaXNba2V5XSk7XG4gIH1cbn07XG5cbk9iamVjdC5pc0VtcHR5ID0gZnVuY3Rpb24gKCkge1xuICByZXR1cm4gdGhpcy5sZW5ndGggPT09IDA7XG59O1xuXG5PYmplY3QucmVwbGFjZUtleUZyb20gPSBmdW5jdGlvbiAoYW5vdGhlck9iaikge1xuICByZXR1cm4gT2JqZWN0LmVudHJpZXModGhpcykucmVkdWNlKChvcCwgW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgY29uc3QgbmV3S2V5ID0gYW5vdGhlck9ialtrZXldO1xuICAgIG9wW25ld0tleSB8fCBrZXldID0gdmFsdWU7XG4gICAgcmV0dXJuIG9wO1xuICB9LCB7fSk7XG4gIC8qaWYgKHR5cGVvZiBhbm90aGVyT2JqID09ICdvYmplY3QnKSB7XG4gICAgZm9yIChjb25zdCBrZXkgaW4gYW5vdGhlck9iaikge1xuICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChhbm90aGVyT2JqLCBrZXkpKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSBhbm90aGVyT2JqW2tleV07XG4gICAgICAgIGRlZltrZXldID0gZWxlbWVudDtcbiAgICAgIH1cbiAgICB9XG4gIH0qL1xufTtcblxuY2xhc3Mgb2JqZWN0X2V4dCB7XG4gIC8qKlxuICAgKiBKb2luIG9iamVjdCB0byBzZXBhcmF0ZWQgc3RyaW5nXG4gICAqICogW10uam9pbigpIGVxdWl2YWxlbnRcbiAgICogQHBhcmFtIG9iaiBPYmplY3RcbiAgICogQHBhcmFtIHNlcGFyYXRvciBkZWZhdWx0IGNvbW1hKCwpXG4gICAqIEByZXR1cm5zIEpvaW5lZCBzdHJpbmdcbiAgICovXG4gIHN0YXRpYyBvYmplY3Rfam9pbihvYmo6IFJlY29yZDxhbnksIHVua25vd24+LCBzZXBhcmF0b3IgPSAnLCcpIHtcbiAgICByZXR1cm4gT2JqZWN0LmtleXMob2JqKVxuICAgICAgLm1hcChmdW5jdGlvbiAoaykge1xuICAgICAgICByZXR1cm4gb2JqW2tdO1xuICAgICAgfSlcbiAgICAgIC5qb2luKHNlcGFyYXRvcik7XG4gIH1cblxuICAvKipcbiAgICogU2ltcGxlIG9iamVjdCBjaGVjay5cbiAgICogQHBhcmFtIGl0ZW1cbiAgICogQHJldHVybnNcbiAgICovXG4gIHN0YXRpYyBpc09iamVjdChpdGVtOiBhbnkpOiBib29sZWFuIHtcbiAgICByZXR1cm4gaXRlbSAmJiB0eXBlb2YgaXRlbSA9PT0gJ29iamVjdCcgJiYgIUFycmF5LmlzQXJyYXkoaXRlbSk7XG4gIH1cblxuICAvKipcbiAgICogRGVlcCBtZXJnZSB0d28gb2JqZWN0cy5cbiAgICogQHBhcmFtIHRhcmdldFxuICAgKiBAcGFyYW0gLi4uc291cmNlc1xuICAgKi9cbiAgc3RhdGljIG1lcmdlRGVlcCh0YXJnZXQ6IFJlY29yZDxhbnksIHVua25vd24+LCAuLi5zb3VyY2VzOiBSZWNvcmQ8YW55LCB1bmtub3duPltdKSB7XG4gICAgaWYgKCFzb3VyY2VzLmxlbmd0aCkgcmV0dXJuIHRhcmdldDtcbiAgICBjb25zdCBzb3VyY2UgPSBzb3VyY2VzLnNoaWZ0KCk7XG5cbiAgICBpZiAob2JqZWN0X2V4dC5pc09iamVjdCh0YXJnZXQpICYmIG9iamVjdF9leHQuaXNPYmplY3Qoc291cmNlKSkge1xuICAgICAgZm9yIChjb25zdCBrZXkgaW4gc291cmNlKSB7XG4gICAgICAgIGlmIChvYmplY3RfZXh0LmlzT2JqZWN0KHNvdXJjZVtrZXldKSkge1xuICAgICAgICAgIGlmICghdGFyZ2V0W2tleV0pIE9iamVjdC5hc3NpZ24odGFyZ2V0LCB7IFtrZXldOiB7fSB9KTtcbiAgICAgICAgICBvYmplY3RfZXh0Lm1lcmdlRGVlcCg8YW55PnRhcmdldFtrZXldLCA8YW55PnNvdXJjZVtrZXldKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBPYmplY3QuYXNzaWduKHRhcmdldCwgeyBba2V5XTogc291cmNlW2tleV0gfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gb2JqZWN0X2V4dC5tZXJnZURlZXAodGFyZ2V0LCAuLi5zb3VyY2VzKTtcbiAgfVxufVxuXG5PYmplY3QucHJvdG90eXBlLm1lcmdlID0gZnVuY3Rpb24gKHRoaXM6IFJlY29yZDxhbnksIHVua25vd24+LCAuLi5vdGhlcnMpIHtcbiAgcmV0dXJuIG9iamVjdF9leHQubWVyZ2VEZWVwKHRoaXMsIC4uLm90aGVycyk7XG59O1xuXG5pZiAodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cgaW5zdGFuY2VvZiBXaW5kb3cpIHtcbiAgd2luZG93Lm9iamVjdF9qb2luID0gb2JqZWN0X2V4dC5vYmplY3Rfam9pbjtcbiAgd2luZG93Lm9iamVjdF9tZXJnZSA9IG9iamVjdF9leHQubWVyZ2VEZWVwO1xuICB3aW5kb3cuaXNPYmplY3QgPSBvYmplY3RfZXh0LmlzT2JqZWN0O1xufSBlbHNlIGlmICh0eXBlb2YgZ2xvYmFsID09ICdvYmplY3QnKSB7XG4gIGdsb2JhbC5vYmplY3Rfam9pbiA9IG9iamVjdF9leHQub2JqZWN0X2pvaW47XG4gIGdsb2JhbC5vYmplY3RfbWVyZ2UgPSBvYmplY3RfZXh0Lm1lcmdlRGVlcDtcbiAgZ2xvYmFsLmlzT2JqZWN0ID0gb2JqZWN0X2V4dC5pc09iamVjdDtcbn1cbmlmICh0eXBlb2YgbW9kdWxlICE9ICd1bmRlZmluZWQnICYmIHR5cGVvZiBtb2R1bGUgPT0gJ29iamVjdCcpIHtcbiAgbW9kdWxlLmV4cG9ydHMgPSBvYmplY3RfZXh0O1xuICBtb2R1bGUuZXhwb3J0cyA9IHtcbiAgICBvYmplY3Rfam9pbjogb2JqZWN0X2V4dC5vYmplY3Rfam9pbixcbiAgICBvYmplY3RfbWVyZ2U6IG9iamVjdF9leHQubWVyZ2VEZWVwLFxuICAgIGlzT2JqZWN0OiBvYmplY3RfZXh0LmlzT2JqZWN0LFxuICB9O1xufVxuIl19